<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtaMind - Ebeveyn Paneli</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 0.5rem;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .voice-ratings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .voice-rating-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .rating-stars {
            font-size: 1.5rem;
            margin: 1rem 0;
        }
        
        .report-section {
            text-align: center;
        }
        
        .generate-report-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .generate-report-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .report-list {
            margin-top: 2rem;
            text-align: left;
        }
        
        .report-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .view-report-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .view-report-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .loading {
            text-align: center;
            font-size: 1.2rem;
            padding: 2rem;
        }
        
        .child-selector {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .child-select {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 1.1rem;
        }
        
        .child-select option {
            background: #333;
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ AtaMind Ebeveyn Paneli</h1>
        <p>√áocuƒüunuzun geli≈üimini takip edin ve iyile≈ütirme √∂nerilerini g√∂r√ºn</p>
    </div>

    <div class="container">
        <div class="child-selector">
            <label for="childSelect">√áocuk Se√ßin:</label>
            <select id="childSelect" class="child-select">
                <option value="demo-child">Demo √áocuk</option>
            </select>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-number" id="todayTime">0</div>
                <div class="stat-label">Bug√ºn Harcadƒ±ƒüƒ± S√ºre (dk)</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-number" id="weekTime">0</div>
                <div class="stat-label">Bu Hafta Toplam (dk)</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-number" id="avgRating">0</div>
                <div class="stat-label">Ortalama Puan</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-number" id="todayActivities">0</div>
                <div class="stat-label">Bug√ºn Tamamlanan Aktivite</div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">üé§ Sesli Mesaj Puanlarƒ±</h2>
            <div class="voice-ratings" id="voiceRatings">
                <div class="loading">Sesli mesaj puanlarƒ± y√ºkleniyor...</div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">üìà Son Aktivite Puanlarƒ±</h2>
            <div id="recentRatings">
                <div class="loading">Son puanlar y√ºkleniyor...</div>
            </div>
        </div>

        <div class="section report-section">
            <h2 class="section-title">üìã 2 Haftalƒ±k Raporlar</h2>
            <p style="margin-bottom: 1.5rem;">√áocuƒüunuzun geli≈üimini detaylƒ± olarak inceleyin</p>
            
            <button class="generate-report-btn" id="generateReport">
                üìä Yeni Rapor Olu≈ütur
            </button>
            
            <div class="report-list" id="reportList">
                <div class="loading">Raporlar y√ºkleniyor...</div>
            </div>
        </div>
    </div>

    <script>
        let currentChildId = 'demo-child';
        
        // Load dashboard data
        async function loadDashboard() {
            try {
                // Load usage statistics
                const statsResponse = await fetch(`/api/child/${currentChildId}/usage-stats`);
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    updateStats(stats);
                } else {
                    // Demo data fallback
                    updateStats({
                        total_time_today: 45.5,
                        total_time_week: 180.3,
                        activities_completed_today: 3,
                        average_rating: 4.2,
                        recent_ratings: [
                            { activity_type: 'voice_message', rating: 5, rated_at: new Date() },
                            { activity_type: 'story', rating: 4, rated_at: new Date() },
                            { activity_type: 'game', rating: 3, rated_at: new Date() }
                        ]
                    });
                }
                
                // Load reports
                await loadReports();
                
            } catch (error) {
                console.error('Dashboard loading error:', error);
                // Use demo data
                updateStats({
                    total_time_today: 45.5,
                    total_time_week: 180.3,
                    activities_completed_today: 3,
                    average_rating: 4.2,
                    recent_ratings: []
                });
            }
        }
        
        function updateStats(stats) {
            document.getElementById('todayTime').textContent = Math.round(stats.total_time_today || 0);
            document.getElementById('weekTime').textContent = Math.round(stats.total_time_week || 0);
            document.getElementById('avgRating').textContent = (stats.average_rating || 0).toFixed(1);
            document.getElementById('todayActivities').textContent = stats.activities_completed_today || 0;
            
            // Update voice ratings
            const voiceRatings = stats.recent_ratings?.filter(r => r.activity_type === 'voice_message') || [];
            displayVoiceRatings(voiceRatings);
            
            // Update recent ratings
            displayRecentRatings(stats.recent_ratings || []);
        }
        
        function displayVoiceRatings(voiceRatings) {
            const container = document.getElementById('voiceRatings');
            
            if (voiceRatings.length === 0) {
                container.innerHTML = `
                    <div class="voice-rating-card">
                        <h3>Hen√ºz sesli mesaj puanƒ± yok</h3>
                        <p>√áocuƒüunuz sesli mesajlarƒ±nƒ±za puan verdiƒüinde burada g√∂r√ºnecek</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = voiceRatings.map(rating => `
                <div class="voice-rating-card">
                    <h3>üé§ Sesli Mesaj</h3>
                    <div class="rating-stars">${'‚≠ê'.repeat(rating.rating)}</div>
                    <p>${rating.feedback_text || 'Geri bildirim yok'}</p>
                    <small>${new Date(rating.rated_at).toLocaleDateString('tr-TR')}</small>
                </div>
            `).join('');
        }
        
        function displayRecentRatings(ratings) {
            const container = document.getElementById('recentRatings');
            
            if (ratings.length === 0) {
                container.innerHTML = '<div class="loading">Hen√ºz aktivite puanƒ± yok</div>';
                return;
            }
            
            const activityTypes = {
                'story': 'üìö Hikaye',
                'voice_message': 'üé§ Sesli Mesaj',
                'game': 'üéÆ Oyun',
                'song': 'üéµ ≈ûarkƒ±',
                'activity': 'üé® Aktivite'
            };
            
            container.innerHTML = ratings.slice(0, 5).map(rating => `
                <div class="report-item">
                    <div>
                        <strong>${activityTypes[rating.activity_type] || rating.activity_type}</strong>
                        <div>${'‚≠ê'.repeat(rating.rating)} (${rating.rating}/5)</div>
                    </div>
                    <div>
                        <small>${new Date(rating.rated_at).toLocaleDateString('tr-TR')}</small>
                    </div>
                </div>
            `).join('');
        }
        
        async function loadReports() {
            try {
                const response = await fetch(`/api/child/${currentChildId}/reports`);
                if (response.ok) {
                    const reports = await response.json();
                    displayReports(reports);
                } else {
                    displayReports([]);
                }
            } catch (error) {
                displayReports([]);
            }
        }
        
        function displayReports(reports) {
            const container = document.getElementById('reportList');
            
            if (reports.length === 0) {
                container.innerHTML = `
                    <div class="report-item">
                        <div>
                            <strong>Hen√ºz rapor yok</strong>
                            <p>ƒ∞lk 2 haftalƒ±k raporu olu≈üturmak i√ßin yukarƒ±daki butona tƒ±klayƒ±n</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = reports.map(report => `
                <div class="report-item">
                    <div>
                        <strong>üìä ${new Date(report.period_start).toLocaleDateString('tr-TR')} - ${new Date(report.period_end).toLocaleDateString('tr-TR')}</strong>
                        <p>Toplam S√ºre: ${Math.round(report.total_time)} dk | Aktivite: ${report.activities} | Sesli Mesaj Ortalamasƒ±: ${(report.voice_rating_avg || 0).toFixed(1)}/5</p>
                    </div>
                    <button class="view-report-btn" onclick="viewReport('${report.id}')">
                        üëÅÔ∏è G√∂r√ºnt√ºle
                    </button>
                </div>
            `).join('');
        }
        
        // Generate new report
        document.getElementById('generateReport').addEventListener('click', async () => {
            const btn = document.getElementById('generateReport');
            btn.textContent = '‚è≥ Rapor Olu≈üturuluyor...';
            btn.disabled = true;
            
            try {
                const response = await fetch(`/api/child/${currentChildId}/generate-report`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const report = await response.json();
                    alert('üéâ Rapor ba≈üarƒ±yla olu≈üturuldu!');
                    loadReports(); // Reload reports
                } else {
                    alert('üìä Demo rapor olu≈üturuldu! (Geli≈ütirme modunda)');
                }
            } catch (error) {
                alert('üìä Demo rapor olu≈üturuldu! (Geli≈ütirme modunda)');
            } finally {
                btn.textContent = 'üìä Yeni Rapor Olu≈ütur';
                btn.disabled = false;
            }
        });
        
        function viewReport(reportId) {
            window.open(`/static/report.html?id=${reportId}&child=${currentChildId}`, '_blank');
        }
        
        // Child selector change
        document.getElementById('childSelect').addEventListener('change', (e) => {
            currentChildId = e.target.value;
            loadDashboard();
        });
        
        // Load dashboard on page load
        loadDashboard();
        
        // Refresh every 30 seconds
        setInterval(loadDashboard, 30000);
    </script>
</body>
</html>